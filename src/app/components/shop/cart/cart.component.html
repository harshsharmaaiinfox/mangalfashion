<app-breadcrumb [breadcrumb]="breadcrumb"></app-breadcrumb>
<section class="cart-section section-b-space">
    <div class="container-fluid-lg">
        <div class="row g-xl-5 g-sm-4 g-3" *ngIf="(cartItem$ | async)?.length">
            <!-- Left Column: Cart Items -->
            <div class="col-xxl-8 col-xl-7 col-lg-7">
                <div class="cart-items-wrapper">
                    <div class="cart-header-section">
                        <h2 class="cart-title">{{ 'shopping_cart' | translate }}</h2>
                        <span class="item-count-badge">{{ (cartItem$ | async)?.length }} {{ 'items' | translate }}</span>
                    </div>

                    <div class="cart-items-list">
                        <div class="cart-item-box" *ngFor="let item of cartItem$ | async">
                            <!-- Product Image -->
                            <div class="item-image-wrapper">
                                <a [routerLink]="['/product/', item?.product?.slug]">
                                    <img [src]="item?.variation && item?.variation?.variation_image
                                            ? item?.variation?.variation_image?.original_url
                                            : item?.product?.product_thumbnail
                                            ? item?.product?.product_thumbnail?.original_url
                                            : 'assets/images/product.png'" 
                                         class="product-img" 
                                         alt="product">
                                </a>
                                <button class="remove-btn" (click)="delete(item.id)" title="{{ 'Remove' | translate }}">
                                    <i class="ri-close-line"></i>
                                </button>
                            </div>

                            <!-- Product Details -->
                            <div class="item-details-wrapper">
                                <h3 class="product-title">
                                    <a [routerLink]="['/product/', item.product.slug]">
                                        {{item?.variation ? item.variation.name : item?.product?.name}}
                                    </a>
                                </h3>
                                
                                <p class="product-unit-text" *ngIf="item?.product && item?.product?.unit">
                                    {{ 'unit' | translate }}: {{item.product.unit}}
                                </p>

                                <!-- Price Row -->
                                <div class="price-row-item">
                                    <span class="price-label">{{ 'Price' | translate }}:</span>
                                    <div class="price-group">
                                        <span class="price-current">
                                            {{ (item?.variation ? item?.variation?.sale_price : item?.product && item?.wholesale_price ? item?.wholesale_price! : item?.product?.sale_price) | currencySymbol }}
                                        </span>
                                        <span class="price-original" *ngIf="item?.product?.discount">
                                            {{ (item?.variation ? item?.variation?.price : item?.product?.price) | currencySymbol }}
                                        </span>
                                    </div>
                                </div>

                                <!-- Savings Info -->
                                <div class="savings-badge theme-color" *ngIf="item?.product?.discount">
                                    <i class="ri-price-tag-3-line"></i>
                                    {{ 'You Save' | translate }}: {{ ((item?.variation ? item?.variation!.price
                                        : item.product.price) - (item.variation
                                        ? item?.variation!.sale_price
                                        : item.product.sale_price)) | currencySymbol }}
                                </div>

                                <!-- Quantity and Save for Later Row -->
                                <div class="quantity-total-wrapper">
                                    <div class="quantity-box">
                                        <label class="quantity-label-text">{{ 'Quantity' | translate }}</label>
                                        <div class="cart_qty">
                                            <div class="input-group">
                                                <app-button
                                                  [class]="'btn qty-btn qty-minus'"
                                                  [id]="'minus_quantity'"
                                                  [spinner]="false"
                                                  [type]="'button'"
                                                  (click)="updateQuantity(item, -1)">
                                                    <i class="ri-subtract-fill"></i>
                                                </app-button>
                                                <input class="form-control input-number qty-input" 
                                                       type="text" 
                                                       name="quantity" 
                                                       value="{{ item.quantity }}" 
                                                       readonly>
                                                <app-button
                                                  [class]="'btn qty-btn qty-plus'"
                                                  [id]="'plus_quantity'"
                                                  [spinner]="false"
                                                  [type]="'button'"
                                                  (click)="updateQuantity(item, 1)">
                                                    <i class="ri-add-line"></i>
                                                </app-button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="save-later-box">
                                        <button class="save-later-btn" (click)="addToWishlist(item)">
                                            <i class="ri-heart-line"></i>
                                            {{ 'Save for Later' | translate }}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Cart Summary -->
            <div class="col-xxl-4 col-xl-5 col-lg-5">
                <div class="cart-summary-box p-sticky">
                    <div class="summary-header-box">
                        <h3 class="summary-title-text">
                            <i class="ri-shopping-cart-line me-2"></i>
                            {{ 'cart_total' | translate }}
                        </h3>
                    </div>

                    <div class="summary-content-box">
                        <div class="summary-row-item">
                            <span class="summary-label-text">{{ 'Subtotal' | translate }}</span>
                            <span class="summary-value-text">{{ (cartTotal$ | async) || 0 | currencySymbol }}</span>
                        </div>

                        <div class="summary-row-item" *ngIf="!(cartDigital$ | async)">
                            <span class="summary-label-text">{{ 'Shipping' | translate }}</span>
                            <span class="summary-value-text text-muted">{{ 'Cost At Checkout' | translate }}</span>
                        </div>

                        <div class="summary-row-item">
                            <span class="summary-label-text">{{ 'Tax' | translate }}</span>
                            <span class="summary-value-text text-muted">{{ 'Cost at Checkout' | translate }}</span>
                        </div>
                    </div>

                    <div class="summary-divider-line"></div>

                    <div class="summary-total-box">
                        <span class="total-label-main">{{ 'Total' | translate }}</span>
                        <span class="total-value-main theme-color">{{ (cartTotal$ | async) || 0 | currencySymbol }}</span>
                    </div>

                    <div class="summary-actions-box">
                        <a class="btn btn-checkout-main" [routerLink]="['/checkout/']">
                            <i class="ri-shopping-bag-3-line me-2"></i>
                            {{ 'Process To Checkout' | translate }}
                        </a>
                        <a class="btn btn-continue-shopping-main" [routerLink]="['/collections/']">
                            <i class="ri-arrow-left-line me-2"></i>
                            {{ 'return_to_shopping' | translate }}
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty Cart State -->
        <app-no-data
            [class]="'no-data-added'"
            [text]="'No Items Added'"
            [description]="'It appears that nothing has been added to your cart.'"
            *ngIf="!(cartItem$ | async)?.length">
        </app-no-data>
    </div>
</section>
